<div class="incidence-container">
  <h1>Incidences</h1>

  <app-message></app-message>

  <div class="actions">
    <app-buttons text="New Incidence" color="primary" (clicked)="goToCreate()"></app-buttons>
    <app-buttons 
    text="Schedule maintenance" 
    color="primary" 
    (clicked)="goToMaintenance()">
    </app-buttons>
  </div>

  <div *ngIf="loading" class="loading">Loading incidences...</div>

  <app-confirm-dialog
    [title]="'Delete Incidence'"
    [message]="'Are you sure you want to delete this incidence?'"
    [show]="showDialog"
    (confirmed)="onConfirmDelete($event)">
  </app-confirm-dialog>

  <table *ngIf="!loading && incidences.length > 0" class="incidence-table">
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
        <th>Start</th>
        <th>End</th>
        <th>Active</th>
        <th>Actions</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let i of incidences">
        <td>{{ i.typeName }}</td>
        <td>{{ i.description }}</td>
        <td>{{ i.start }}</td>
        <td>{{ i.end }}</td>
        <td>{{ i.active }}</td>
      <td class="action-buttons">

        <ng-container *ngIf="isExpired(i); else normalActions">
          <span class="expired-text">Finished</span>
        </ng-container>

        <ng-template #normalActions>
          <app-buttons
            [text]="i.active === 'True' ? 'Deactivate' : 'Activate'"
            [color]="i.active === 'True' ? 'secondary' : 'primary'"
            (clicked)="toggleActive(i)">
          </app-buttons>

        <app-buttons
          text="Delete"
          color="danger"
          (clicked)="askDelete(i.id)">
        </app-buttons>
        </ng-template>

      </td>

      </tr>
    </tbody>
  </table>

  <div *ngIf="!loading && incidences.length === 0" class="empty">
    No incidences found.
  </div>
</div>
